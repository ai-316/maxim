<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hugo's ê²©ì–¸ ë…¸íŠ¸ â€” Short Aphorisms</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#9ad3bc; --muted:#98a0aa; --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Noto Sans KR", Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#071028 0%, #071b2b 60%);
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    padding:28px;
    min-height:100vh;
    display:flex;
    gap:20px;
    align-items:flex-start;
    justify-content:center;
  }
  .app{
    width:980px;
    max-width:96%;
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:20px;
  }

  header{grid-column:1/-1; margin-bottom:6px}
  h1{margin:0; font-size:20px; letter-spacing:0.4px}
  p.sub{margin:6px 0 0; color:var(--muted); font-size:13px}

  .panel{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04);
    padding:14px;
    border-radius:12px;
    box-shadow: 0 6px 18px rgba(2,6,23,0.6);
  }

  /* editor */
  .editor textarea{
    width:100%;
    min-height:120px;
    resize:vertical;
    background:var(--glass);
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.03);
    color:inherit;
    padding:10px;
    font-size:15px;
  }
  .row{display:flex; gap:8px; margin-top:10px; align-items:center}
  .row .input{
    flex:1;
  }
  .input input{
    width:100%;
    padding:9px 10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.04);
    background:transparent;
    color:inherit;
    font-size:14px;
  }
  button.btn{
    background:linear-gradient(180deg,var(--accent), #7fc4aa);
    color:#042028;
    border:none;
    padding:10px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
  }
  button.ghost{
    background:transparent;
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.03);
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
  }

  /* list */
  .list-wrap{overflow:auto; max-height:64vh; padding:6px; margin-top:8px}
  ul.aph-list{list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px}
  li.aph{
    display:flex;
    gap:10px;
    align-items:flex-start;
    background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    border-radius:10px;
    padding:10px;
    border:1px solid rgba(255,255,255,0.03);
    cursor:grab;
  }
  li.aph.dragging{opacity:0.6}
  .meta{width:46px; text-align:center; font-size:12px; color:var(--muted)}
  .content{flex:1}
  .content p{margin:0; font-size:15px}
  .tags{margin-top:6px; display:flex; gap:6px; flex-wrap:wrap}
  .tag{font-size:12px; color:#053; background:rgba(255,255,255,0.03); padding:4px 6px; border-radius:6px; color:var(--muted)}
  .controls{display:flex; gap:6px; margin-left:6px; align-items:center}
  .icon-btn{background:transparent; border:none; color:var(--muted); cursor:pointer; padding:6px; border-radius:6px}
  .fav{color:#ffde59}
  .small{font-size:12px;color:var(--muted)}

  /* right column */
  .right .card{margin-bottom:12px}
  .random{font-size:14px; padding:12px; border-radius:8px; background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01)); text-align:center}
  .tools{display:grid; grid-template-columns:1fr 1fr; gap:8px}
  input[type="file"]{display:none}
  .hint{font-size:12px; color:var(--muted); margin-top:8px}
  footer.small{grid-column:1/-1; text-align:right; color:var(--muted); font-size:12px; margin-top:6px}

  @media (max-width:880px){
    .app{grid-template-columns:1fr; }
    .right{order:2}
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <h1>ê²©ì–¸ ë…¸íŠ¸ â€” Short Aphorisms</h1>
      <p class="sub">ì§§ì€ ê¹¨ë‹¬ìŒë“¤ì„ ëª¨ìœ¼ê³ , ë‹¤ë“¬ê³ , êº¼ë‚´ì–´ ì½ëŠ” ê³³. ë§ˆìš°ìŠ¤ë¡œ ì¶”ê°€í•˜ê³ , ëŒì–´ ì •ë ¬í•˜ê³ , ë‚´ë³´ë‚´ì„¸ìš”.</p>
    </header>

    <section class="panel editor">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>ìƒˆ ê²©ì–¸ ì¶”ê°€</strong>
        <div class="small">Ctrl/Cmd + Enterë¡œ ë¹ ë¥´ê²Œ ì¶”ê°€</div>
      </div>

      <textarea id="txt" placeholder="ì‚¬ì†Œí•œ ê¹¨ë‹¬ìŒ í•œ ì¤„ì„ ì…ë ¥í•´ ë³´ì„¸ìš”. (ì˜ˆ: 'ì¹¨ë¬µì€ ë•Œë¡œ ê°€ì¥ ì„ ëª…í•œ ëŒ€ë‹µì´ë‹¤.')"></textarea>

      <div class="row">
        <div class="input"><input id="tagInput" placeholder="íƒœê·¸(ì‰¼í‘œë¡œ êµ¬ë¶„) â€” ì˜ˆ: ì‚¶,ê´€ê³„,ìŠµê´€" /></div>
        <button class="btn" id="addBtn">ì¶”ê°€</button>
        <button class="ghost" id="clearAll">ëª¨ë‘ ì‚­ì œ</button>
      </div>

      <div class="row" style="margin-top:12px">
        <input id="search" class="input" placeholder="ê²€ìƒ‰: ë‹¨ì–´/íƒœê·¸ë¡œ í•„í„°" style="padding:9px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03); color:inherit"/>
        <div style="display:flex;gap:8px">
          <button class="ghost" id="sortFav">ì¦ê²¨ì°¾ê¸° ìš°ì„ </button>
          <button class="ghost" id="shuffle">ëœë¤ ë³´ê¸°</button>
        </div>
      </div>

      <div class="list-wrap">
        <ul id="aphList" class="aph-list"></ul>
      </div>
    </section>

    <aside class="panel right">
      <div class="card random">
        <div style="font-size:13px;color:var(--muted)">ì˜¤ëŠ˜ì˜ ê²©ì–¸</div>
        <div id="randomText" style="margin-top:10px;font-weight:700;font-size:16px">â€” í´ë¦­í•˜ì—¬ ë¬´ì‘ìœ„ë¡œ êº¼ë‚´ì„¸ìš” â€”</div>
        <div style="margin-top:10px">
          <button class="btn" id="randBtn">ë¬´ì‘ìœ„ êº¼ë‚´ê¸°</button>
          <button class="ghost" id="copyRandom">ë³µì‚¬</button>
        </div>
      </div>

      <div class="card panel">
        <strong>ë‚´ë³´ë‚´ê¸° / ê°€ì ¸ì˜¤ê¸°</strong>
        <div class="tools" style="margin-top:8px">
          <button class="btn" id="exportJson">JSON ë‚´ë³´ë‚´ê¸°</button>
          <button class="btn" id="downloadTxt">í…ìŠ¤íŠ¸ ë‹¤ìš´ë¡œë“œ</button>
          <label for="importFile" class="ghost" style="text-align:center; padding:9px; border-radius:8px; cursor:pointer;">ê°€ì ¸ì˜¤ê¸°
            <input id="importFile" type="file" accept="application/json"/>
          </label>
          <button class="ghost" id="clearLocal">ë¡œì»¬ ì´ˆê¸°í™”</button>
        </div>
        <div class="hint">ë¡œì»¬ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤. GitHubì— ì˜¬ë¦¬ë ¤ë©´ ì´ íŒŒì¼ì„ repoì— ì—…ë¡œë“œí•˜ì„¸ìš”.</div>
      </div>

      <div class="card panel">
        <strong>ì‚¬ìš© íŒ</strong>
        <div class="hint">
          â€¢ ë²„íŠ¼ í´ë¦­ìœ¼ë¡œ í•­ëª© ì„ íƒ/í¸ì§‘ â€¢ í•­ëª©ì„ ë“œë˜ê·¸í•´ì„œ ìœ„ì¹˜ ë³€ê²½ ê°€ëŠ¥ â€¢ ì¦ê²¨ì°¾ê¸° ë³„í‘œë¡œ í‘œì‹œ
        </div>
      </div>
    </aside>

    <footer class="small">ê°„ë‹¨í•œ ë¡œì»¬ ì•± â€” íœ´ê³ ì˜ ì‚¬ìƒ‰ì„ ìœ„í•œ ê³µê°„</footer>
  </div>

<script>
/* ê°„ë‹¨í•œ ë¡œì»¬ DB (localStorage) ê¸°ë°˜ ê²©ì–¸ ë…¸íŠ¸ */
const STORAGE_KEY = 'aphorisms_v1_hugo';

let state = {
  items: []
};

function genId(){ return 'a'+Date.now() + Math.floor(Math.random()*999) }

function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    state.items = raw ? JSON.parse(raw) : sampleData();
  }catch(e){ state.items = sampleData(); }
}

function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state.items));
}

function sampleData(){
  return [
    {id:genId(), text:"ì¹¨ë¬µì€ ë•Œë¡œ ê°€ì¥ ì„ ëª…í•œ ëŒ€ë‹µì´ë‹¤.", tags:["ì¹¨ë¬µ","ì‚¬ìœ "], fav:false, created:Date.now()},
    {id:genId(), text:"ì‘ì€ ìŠµê´€ì´ í•˜ë£¨ë¥¼ ì§€ë°°í•˜ê³ , í•˜ë£¨ê°€ ì¸ìƒì„ ë°”ê¾¼ë‹¤.", tags:["ìŠµê´€"], fav:false, created:Date.now()},
    {id:genId(), text:"ì§ˆë¬¸ì´ ëª…í™•í•˜ë©´ ì‘ë‹µë„ ë§‘ì•„ì§„ë‹¤.", tags:["ì‚¬ìƒ‰"], fav:true, created:Date.now()}
  ];
}

/* ë Œë”ë§ */
const listEl = document.getElementById('aphList');
const txt = document.getElementById('txt');
const tagInput = document.getElementById('tagInput');
const addBtn = document.getElementById('addBtn');
const search = document.getElementById('search');

function render(filter=''){
  listEl.innerHTML = '';
  const q = filter.trim().toLowerCase();
  const items = state.items.filter(it=>{
    if(!q) return true;
    return it.text.toLowerCase().includes(q) || (it.tags && it.tags.join(' ').toLowerCase().includes(q));
  });

  items.forEach((it, idx)=>{
    const li = document.createElement('li');
    li.className = 'aph';
    li.draggable = true;
    li.dataset.id = it.id;

    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.innerHTML = `<div style="font-weight:700">${idx+1}</div><div class="small">${new Date(it.created).toLocaleDateString()}</div>`;

    const content = document.createElement('div');
    content.className = 'content';
    const p = document.createElement('p');
    p.textContent = it.text;
    content.appendChild(p);

    if(it.tags && it.tags.length){
      const tags = document.createElement('div');
      tags.className = 'tags';
      it.tags.forEach(t=>{
        const span = document.createElement('span'); span.className='tag'; span.textContent = t;
        tags.appendChild(span);
      });
      content.appendChild(tags);
    }

    const controls = document.createElement('div');
    controls.className = 'controls';

    const favBtn = document.createElement('button');
    favBtn.className = 'icon-btn';
    favBtn.innerHTML = it.fav? 'â˜…':'â˜†';
    if(it.fav) favBtn.classList.add('fav');
    favBtn.title='ì¦ê²¨ì°¾ê¸° í† ê¸€';
    favBtn.onclick = () => { toggleFav(it.id); };

    const editBtn = document.createElement('button');
    editBtn.className = 'icon-btn';
    editBtn.title='í¸ì§‘';
    editBtn.innerHTML = 'âœ';
    editBtn.onclick = () => { enterEdit(it.id); };

    const delBtn = document.createElement('button');
    delBtn.className = 'icon-btn';
    delBtn.title='ì‚­ì œ';
    delBtn.innerHTML = 'ğŸ—‘';
    delBtn.onclick = ()=> { if(confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) removeItem(it.id); };

    const copyBtn = document.createElement('button');
    copyBtn.className = 'icon-btn';
    copyBtn.title='ë³µì‚¬';
    copyBtn.innerHTML='â˜';
    copyBtn.onclick = ()=> { navigator.clipboard?.writeText(it.text).then(()=>alert('ë³µì‚¬ë¨')) };

    controls.appendChild(favBtn);
    controls.appendChild(editBtn);
    controls.appendChild(copyBtn);
    controls.appendChild(delBtn);

    li.appendChild(meta);
    li.appendChild(content);
    li.appendChild(controls);

    /* drag events */
    li.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', it.id);
      li.classList.add('dragging');
    });
    li.addEventListener('dragend', e => {
      li.classList.remove('dragging');
    });

    li.addEventListener('click', (e)=>{
      // í´ë¦­í•˜ë©´ ì˜¤ë¥¸ìª½ 'ì˜¤ëŠ˜ì˜ ê²©ì–¸'ì— í‘œì‹œ
      document.getElementById('randomText').textContent = it.text;
    });

    listEl.appendChild(li);
  });

  // setup drop zone ordering
  const kids = Array.from(listEl.children);
  kids.forEach(k=>{
    k.addEventListener('dragover', e=>{
      e.preventDefault();
      const dragging = listEl.querySelector('.dragging');
      if(!dragging || dragging===k) return;
      // insert before or after
      const rect = k.getBoundingClientRect();
      const mid = rect.top + rect.height/2;
      if(event.clientY < mid){
        listEl.insertBefore(dragging, k);
      }else{
        listEl.insertBefore(dragging, k.nextSibling);
      }
    });
  });
}

/* ì €ì¥ í›„ ë Œë” í˜¸ì¶œ */
function persistAndRender(){
  // read order from DOM and recompose state.items
  const order = Array.from(listEl.children).map(li=>li.dataset.id);
  if(order.length === state.items.length){
    const map = state.items.reduce((s,i)=>{s[i.id]=i; return s}, {});
    state.items = order.map(id => map[id] || state.items.find(x=>x.id===id)).filter(Boolean);
  }
  save();
  render(search.value);
}

/* ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë“¤ */
addBtn.addEventListener('click', ()=>{
  const text = txt.value.trim();
  if(!text){ alert('ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”.'); txt.focus(); return; }
  const tags = tagInput.value.split(',').map(s=>s.trim()).filter(Boolean);
  state.items.unshift({id:genId(), text, tags, fav:false, created:Date.now()});
  txt.value=''; tagInput.value='';
  persistAndRender();
});

txt.addEventListener('keydown', (e)=>{
  if((e.ctrlKey || e.metaKey) && e.key === 'Enter'){
    addBtn.click();
  }
});

search.addEventListener('input', ()=>render(search.value));

function toggleFav(id){
  const it = state.items.find(x=>x.id===id);
  if(!it) return;
  it.fav = !it.fav;
  save();
  render(search.value);
}

function enterEdit(id){
  const it = state.items.find(x=>x.id===id);
  if(!it) return;
  const newText = prompt('ë¬¸ì¥ ìˆ˜ì •', it.text);
  if(newText === null) return;
  it.text = newText.trim() || it.text;
  const newTags = prompt('íƒœê·¸(ì‰¼í‘œ êµ¬ë¶„)', (it.tags||[]).join(','));
  if(newTags !== null) it.tags = newTags.split(',').map(s=>s.trim()).filter(Boolean);
  save();
  render(search.value);
}

function removeItem(id){
  state.items = state.items.filter(x=>x.id!==id);
  save();
  render(search.value);
}

/* ì˜¤ë¥¸ìª½ íˆ´ë“¤ */
document.getElementById('randBtn').addEventListener('click', ()=>{
  if(!state.items.length){ alert('ê²©ì–¸ì´ ì—†ìŠµë‹ˆë‹¤. ì¶”ê°€í•´ ì£¼ì„¸ìš”.'); return; }
  const r = state.items[Math.floor(Math.random()*state.items.length)];
  document.getElementById('randomText').textContent = r.text;
});

document.getElementById('copyRandom').addEventListener('click', ()=>{
  const t = document.getElementById('randomText').textContent;
  if(!t) return alert('ë¨¼ì € í•˜ë‚˜ ê³¨ë¼ ì£¼ì„¸ìš”.');
  navigator.clipboard?.writeText(t).then(()=>alert('ë³µì‚¬ë¨'));
});

document.getElementById('clearAll').addEventListener('click', ()=>{
  if(!confirm('ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë³µêµ¬ ë¶ˆê°€)')) return;
  state.items = [];
  save();
  render();
});

document.getElementById('shuffle').addEventListener('click', ()=>{
  state.items = state.items.sort(()=>Math.random()-0.5);
  save();
  render();
});

document.getElementById('sortFav').addEventListener('click', ()=>{
  state.items = state.items.slice().sort((a,b)=> (b.fav?1:0) - (a.fav?1:0));
  save();
  render();
});

/* export / import */
document.getElementById('exportJson').addEventListener('click', ()=>{
  const data = JSON.stringify(state.items, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = 'aphorisms.json'; a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('downloadTxt').addEventListener('click', ()=>{
  const txts = state.items.map(i=> `- ${i.text} ${i.tags && i.tags.length ? '['+i.tags.join(',')+']':''}`).join('\n');
  const blob = new Blob([txts], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download = 'aphorisms.txt'; a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('importFile').addEventListener('change', (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{
    try{
      const arr = JSON.parse(reader.result);
      if(!Array.isArray(arr)) throw new Error('ì˜¬ë°”ë¥¸ JSON ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤.');
      // ê°„ë‹¨ í•©ì¹˜ê¸°
      const normalized = arr.map(x=>({ id: x.id || genId(), text: x.text||'', tags: x.tags||[], fav: !!x.fav, created: x.created || Date.now() }));
      state.items = normalized.concat(state.items);
      save(); render();
      alert('ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ');
    }catch(err){ alert('ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ' + err.message) }
  };
  reader.readAsText(f);
});

/* ì´ˆê¸° ë¡œë“œ */
load();
render();

/* ì €ì¥ ìë™ ì£¼ê¸° (ì•ˆì •ì„±) */
window.addEventListener('beforeunload', ()=> save());

/* drag-to-order ì €ì¥: ì €ì¥ ë²„íŠ¼ ëŒ€ì‹  ë§ˆìš°ìŠ¤ ì—… ì‹œ ìƒíƒœ ë°˜ì˜ */
document.addEventListener('mouseup', ()=> {
  // reorder if needed
  const order = Array.from(listEl.children).map(li=>li.dataset.id);
  if(order.length === state.items.length){
    const map = state.items.reduce((s,i)=>{s[i.id]=i; return s}, {});
    state.items = order.map(id => map[id] || state.items.find(x=>x.id===id)).filter(Boolean);
    save();
    render(search.value);
  }
});

</script>
</body>
</html>
